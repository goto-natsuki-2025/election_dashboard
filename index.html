<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>選挙集図盤</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/search.css" />
  </head>
  <body>
    <header>
      <h1>選挙集図盤</h1>
      <p>
        直近4年分の最新選挙結果をもとに、議席の分布や候補者動向を可視化します。政党別の勢力推移と、全国の候補者情報を検索できるツールです。
      </p>
    </header>
    <main>
      <nav class="dashboard-nav" aria-label="機能切替">
        <button
          type="button"
          class="dashboard-tab is-active"
          id="tab-party"
          data-view="party-dashboard"
          aria-controls="party-dashboard"
          aria-selected="true"
        >
          各党の所属議員数
        </button>
        <button
          type="button"
          class="dashboard-tab"
          id="tab-compensation"
          data-view="compensation-dashboard"
          aria-controls="compensation-dashboard"
          aria-selected="false"
        >
          議員報酬推計
        </button>
        <button
          type="button"
          class="dashboard-tab"
          id="tab-search"
          data-view="search-dashboard"
          aria-controls="search-dashboard"
          aria-selected="false"
        >
          選挙結果検索
        </button>
      </nav>

      <section
        id="party-dashboard"
        class="dashboard-view is-active"
        role="region"
        aria-labelledby="tab-party"
      >
        <section class="summary-grid">
          <article class="summary-item">
            <span>対象自治体</span>
            <strong id="summary-municipalities">-</strong>
            <small>直近4年分の最新選挙を集計</small>
          </article>
          <article class="summary-item">
            <span>集計議席数</span>
            <strong id="summary-seats">-</strong>
            <small>各自治体の最新選挙の総議席数</small>
          </article>
          <article class="summary-item">
            <span>掲載政党数</span>
            <strong id="summary-parties">-</strong>
            <small>掲載されている政党・会派の数</small>
          </article>
        </section>

        <section class="card">
          <h2>政党別所属議員数</h2>
          <p class="description">
            最新選挙で当選した議員を政党・会派ごとに集計した座席数を表示しています（上位会派のみ表示）。
          </p>
          <div class="party-metric-grid" id="party-metric-grid" aria-live="polite"></div>
        </section>

        <section class="card">
          <h2>政党別所属議員数の推移</h2>
          <p class="description">
            各自治体の最新選挙日を時系列に並べ、累積議席数の推移を描画しています。折れ線は政党ごとの勢力の伸び縮みを示します（上位会派のみ表示）。
          </p>
          <div id="party-trend-chart" class="chart" aria-label="政党別所属議員数の推移"></div>
        </section>
      </section>

      <section
        id="compensation-dashboard"
        class="dashboard-view"
        role="region"
        aria-labelledby="tab-compensation"
      >
        <section class="card">
          <h2>政党別議員報酬推計</h2>
          <p class="description" id="compensation-description">
            2020年時点の議員報酬月額と期末手当支給率を基準に、選挙実施月から次回選挙（または任期満了）までの在任月数と支給月を按分した推計です。
          </p>
          <form class="compensation-controls" aria-label="集計期間の設定">
            <label for="compensation-year-span">
              集計に含める最新の年数
              <small>（スマートフォンでは少ない件数で開始します）</small>
            </label>
            <div class="control-group">
              <input
                type="number"
                id="compensation-year-span"
                name="compensation-year-span"
                min="0"
                max="50"
                step="1"
                value="0"
                inputmode="numeric"
              />
              <button type="button" id="compensation-apply-span" class="button is-small">
                反映する
              </button>
            </div>
            <p class="help-text" id="compensation-span-help">
              0 を指定すると全期間を対象にします。
            </p>
          </form>
          <div class="summary-grid"><div class="summary-grid"><div class="summary-grid"><div class="summary-grid">
            <article class="summary-item">
              <span>推計総額</span>
              <strong id="comp-summary-total">-</strong>
              <small id="comp-summary-note"></small>
            </article>
            <article class="summary-item">
              <span>座席数</span>
              <strong id="comp-summary-seats">-</strong>
              <small>推計対象となった議員数</small>
            </article>
            <article class="summary-item">
              <span>自治体数</span>
              <strong id="comp-summary-municipalities">-</strong>
              <small>突合できた自治体数</small>
            </article>
          </div>
        </section>

        <section class="card">
          <h3>政党別推計年額（上位10党）</h3>
          <div
            id="compensation-bar-chart"
            class="chart compensation-chart"
            aria-label="政党別推計年額（上位10党）"
          ></div>
        </section>

        <section class="card">
          <h3>年別推移（推計上位党）</h3>
          <div
            id="compensation-trend-chart"
            class="chart compensation-chart"
            aria-label="年別推移（推計上位党）"
          ></div>
        </section>

        <section class="card">
          <h3>政党別推計年額ランキング</h3>
          <p class="description">
            推計年額は、自治体別に算出した年額（議員報酬月額×(12 + 期末手当率の合計/100)）に当選議員数を掛けて集計しています。
          </p>
          <div class="compensation-table-wrapper">
            <table class="search-table">
              <thead>
                <tr>
                  <th scope="col">順位</th>
                  <th scope="col">政党</th>
                  <th scope="col">座席数</th>
                  <th scope="col">自治体数</th>
                  <th scope="col">推計年額</th>
                </tr>
              </thead>
              <tbody id="compensation-table-body"></tbody>
            </table>
          </div>
          <p id="compensation-error" class="compensation-error" hidden></p>
        </section>
      </section>

      <section
        id="search-dashboard"
        class="dashboard-view"
        role="region"
        aria-labelledby="tab-search"
      >
        <section class="search-intro card">
          <h2>選挙結果検索</h2>
          <p class="search-description">
            データセット全体から候補者情報を検索できます。選挙名や日付で絞り込み、候補者の属性や得票状況を確認してください。
          </p>
          <div class="search-summary-grid">
            <article class="search-summary-item">
              <span>掲載選挙数</span>
              <strong id="search-summary-elections">-</strong>
            </article>
            <article class="search-summary-item">
              <span>候補者数</span>
              <strong id="search-summary-candidates">-</strong>
            </article>
            <article class="search-summary-item">
              <span>政党・会派数</span>
              <strong id="search-summary-parties">-</strong>
            </article>
            <article class="search-summary-item">
              <span>平均競争倍率</span>
              <strong id="search-summary-competition">-</strong>
            </article>
          </div>
          <form class="search-filters" id="search-filters" novalidate>
            <div class="search-filter-group">
              <label for="search-text">選挙名で検索</label>
              <input id="search-text" type="search" placeholder="例: 横浜市長選挙" />
            </div>
            <div class="search-filter-group">
              <label for="party-select">政党・会派で絞り込み</label>
              <select id="party-select">
                <option value="">すべて</option>
              </select>
            </div>
            <div class="search-filter-group">
              <label>投票日で絞り込み</label>
              <div class="search-date-range">
                <input id="date-start" type="date" aria-label="開始日" />
                <input id="date-end" type="date" aria-label="終了日" />
              </div>
            </div>
            <div class="search-filter-actions">
              <button id="reset-button" type="button" class="search-reset">
                条件をクリア
              </button>
            </div>
          </form>
        </section>

        <section class="search-layout">
          <article class="search-card">
            <h3>年別の選挙件数</h3>
            <div id="timeline-chart" class="search-chart" aria-label="年別の選挙件数"></div>
          </article>
          <article class="search-card">
            <h3>政党別の出馬状況</h3>
            <div id="party-chart" class="search-chart" aria-label="政党別の出馬状況"></div>
          </article>
          <article class="search-card">
            <h3>候補者属性の構成</h3>
            <div
              id="demographics-chart"
              class="search-chart"
              aria-label="候補者属性の構成"
            ></div>
          </article>
        </section>

        <section class="search-card">
          <div class="search-results-header">
            <h3>検索結果</h3>
            <p id="results-count" class="search-results-count">0 件表示中</p>
          </div>
          <div class="search-table-wrapper">
            <table class="search-table">
              <thead>
                <tr>
                  <th scope="col">選挙名</th>
                  <th scope="col">投票日</th>
                  <th scope="col">定数</th>
                  <th scope="col">候補者数</th>
                  <th scope="col">政党・会派</th>
                  <th scope="col">結果</th>
                </tr>
              </thead>
              <tbody id="results-body"></tbody>
            </table>
          </div>
        </section>
      </section>
    </main>
    <footer id="data-range-note"></footer>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script type="module" src="assets/js/main.js"></script>
  </body>
</html>



